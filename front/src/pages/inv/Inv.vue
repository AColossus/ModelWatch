<template>
    <div class="inv-wrapper">
        <mw-nav :outUser="user"/>
        <el-card class="box-card">
            <div slot="header" >
                <span style="padding-left:170px;"><i class="el-icon-message"></i><span style="color:rgb(137, 150, 173);padding-left:10px;">{{invitation.uUsername}}的邀请函</span></span>
            </div>
            <div class="inv">
                <el-row style="font-size:25px;margin-bottom:30px;padding-top:20px;">邀请信息</el-row>
                <el-row style="display:flex;align-items: center;justify-content: center;">
                    <img :src='invitation.uAvater' class="figure">
                    <i class="el-icon-plus" style="margin:0px 30px;font-size:30px"></i>
                    <img :src='invitation.mAvater' class="figure" >
                </el-row>    
                <el-row>
                    <div style="padding-top:40px;padding-bottom:20px;">
                    <span class="tag"><a href="">@{{invitation.uUsername}}</a>邀请你在{{invitation.pName}}<br>项目上进行协作</span>
                    </div>
                </el-row>
                <el-row>
                    <div style="padding-top:20px;padding-bottom:30px;border-bottom:1px solid rgb(233, 237, 245); ">
                        <el-button type="primary" plain @click="accept">接受邀请</el-button>
                        <el-button type="info" plain @click="decline">拒绝邀请</el-button>
                    </div>
                </el-row>
                <el-row>
                    <div style="padding:25px 0px;font-size:18px;text-align:center;">
                        您可以接受或拒绝这个邀请。您也可以去查阅<a href="">{{invitation.pName}}</a><br>资料库或访问以了解更多...
                    </div>
                </el-row>
            </div>
        </el-card>
        <el-dialog
          title="请先登录"
          :visible.sync="dialogVisible"
          :close-on-click-modal="false"
          :close-on-press-escape="false"
          :show-close="false"
          width="30%"
          >
            <el-input v-model="uUsername" placeholder="请输入用户名" style="margin-bottom:10px"></el-input>
            <el-input type="password" placeholder="请输入密码" v-model="uPassword"></el-input>
          <span slot="footer" class="dialog-footer">
            <el-button type="primary" @click="login">确 定</el-button>
          </span>
        </el-dialog>
    </div>
 

</template>

<style>
    .inv-wrapper{
        overflow-x: hidden;
        background: #f9f9f9;
        position: absolute;
        height: 100%;
        width: 100%;
        font-family: 'PingFang SC'
    }
    .box-card {
        width: 100%;
        background-color:rgb(242, 246, 252);
        max-width: 1280px;
        margin: 0px auto;
        
    }
    .inv{
        position: relative;
        align-content:center;
        text-align: center;
    }
    .figure{
        border-color:rgb(175, 198, 241);
        border-width: 3px;
        border-style: solid;
        border-radius: 5px;
        width: 80px;
        height: 80px;
    }
    .el-card__header{
        background-color:rgb(233, 237, 245); 
    }
    .el-card__body{
        padding:0px;
    }
    .tag{
        /* font-family: 'Times New Roman', Times, serif; */
        font-size: 22px;
    }
    img:hover{ transform:scale(1.02,1.02)}
    a:link{
        text-decoration:none;
    }
    a:visited{
        text-decoration:none;
    }
    a:hover{text-decoration:underline;}
    a:active{text-decoration:none;}
</style>

<script>
import mwNav from '@/WatchComponents/ModelWatchNav.vue'
export default {
    data(){
        return{
            pid:'',
            myName:'',
            invitation:[],
            uUsername:'',
            uPassword:'',
            dialogVisible:true,
            user:{

            }
        }
    },
    methods:{
        accept(){
            this.$http.get('/api/invitation/updateState/'+this.pid+'/'+this.myName).then((Response)=>{
                    if(Response.data){
                        window.location.href="/project#/"+this.$route.params.pId
                    }
                    else{alert("邀请不存在！");}
            });
        },
        decline(){
            this.$http.get('/api/invitation/deleteWaitState/'+this.pid+'/'+this.myName).then((Response)=>{
                    if(Response.data==1){window.location.href="/";}
                    else{alert("页面出错");}
            });
        },
        login(){
            this.$http.post('/api/user/login',{
                uUsername:this.uUsername,
                uPassword:this.uPassword
            }).then(Response=>{
                if(Response.data == true){
                    alert("登录成功")
                    this.dialogVisible =false;
                    this.user = {a:'123'};
                }
                else{
                    alert("账户或密码错误");
                }
            },Response=>{
                alert("服务器出现异常")
            })
        }
    },
    created(){
        this.pid=this.$route.params.pId;
        this.myName=this.$route.params.myName;
        this.$http.get('/api/user').then(response=>{
            console.log(response.data)
            if(response.data=='') this.dialogVisible =true;
            else this.dialogVisible=false;
        })
        this.$http.get('/api/invitation/findMessage/'+this.pid+'/'+this.myName).then((Response)=>{
                   this.invitation=Response.data;
        });
    },
    components:{mwNav}
}

</script>

